#!/usr/bin/env python3
import os
from granian.cli import cli


def parse_args_file() -> list[str]:
    args = []
    with open("/openedx/granian-config") as f:
        for line in f:
            line = line.strip()
            if not line or line.startswith("#"):
                # skip empty lines and comments
                continue

            # Expand environment variables like $VAR_NAME
            line = os.path.expandvars(line)

            # Split by first space (for options with values)
            if " " in line:
                option, value = line.split(" ", 1)
                args.append(option)
                args.append(value)
            else:
                # flags without values
                args.append(line)
    return args


def run():
    cli(args=parse_args_file(), standalone_mode=False)

if __name__ == "__main__":
    run()